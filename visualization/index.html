<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Coding Math Visualizer | Brilliant Style</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
  </head>
  <body>
    <button id="mobile-tabs-btn" aria-label="Toggle cases">â˜° Cases</button>
    <div id="mobile-tabs-backdrop"></div>
    <div class="container">
        <!-- Tab Selection -->
        <nav class="case-tabs">
            <div class="tab-group" data-group="visual">
                <span class="group-label">Visual</span>
                <div class="tab-row">
                    <div class="tab" data-case="golden">Golden Spiral</div>
                    <div class="tab" data-case="rainbow">Rainbow Spiral</div>
                    <div class="tab active" data-case="waves">Waves</div>
                    <div class="tab" data-case="hexagon">Hex Grid</div>
                    <div class="tab" data-case="damage">Damage Rolls</div>
                    <div class="tab" data-case="modulo-circle">Modulo Circle</div>
                    <div class="tab" data-case="orbit-spirograph">Orbit Spirograph</div>
                </div>
            </div>
        </nav>

        <header id="header">
            <h1 id="main-title">The Geometry of Waves</h1>
            <p class="subtitle" id="main-subtitle">Mathematical waves turning into geometric patterns.</p>
        </header>

        <main class="dashboard-card">
            <!-- Visualization Canvas -->
            <div class="canvas-container" id="capture-zone">
                <div id="formula-overlay" class="formula-overlay"></div>
                <canvas id="mathCanvas"></canvas>
            </div>

            <!-- Controls Holders (Dynamic) -->
            <aside class="controls-shell">
                <section id="display-controls" class="controls active" data-mode="display">
                    <!-- Display mode controls -->
                </section>
                <section id="interactive-controls" class="controls" data-mode="interactive">
                    <!-- Interactive mode controls -->
                </section>
            </aside>
        </main>
    </div>

    <!-- Sleep Mode Overlay -->
    <div id="sleep-overlay">
        <div class="sleep-content">
            <h2>Deep Sleep Mode</h2>
            <p>System paused due to inactivity.<br>Move mouse or click to resume.</p>
            <div class="btn-primary" onclick="Core.resetIdleTimer()">Resume Activity</div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="audio.js"></script>
    <script src="core.js"></script>
    <script src="cases/waves.js"></script>
    <script src="cases/rainbow_spiral.js"></script>
    <script src="cases/golden_spiral.js"></script>
    <script src="cases/hexagon_grid.js"></script>
    <script src="cases/damage_rolls.js"></script>
    <script src="cases/modulo_circle.js"></script>
    <script src="cases/orbit_spirograph.js"></script>
    <script>
        // Tab Management
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                document.body.classList.remove('mobile-tabs-open');
                
                const caseName = tab.getAttribute('data-case');
                if (caseName === 'waves') {
                    document.getElementById('main-title').textContent = 'The Geometry of Waves';
                    document.getElementById('main-subtitle').textContent = 'Mathematical waves turning into geometric patterns.';
                    Core.loadCase(WavesCase, { mode: 'display' });
                } else if (caseName === 'rainbow') {
                    document.getElementById('main-title').textContent = 'Rainbow Spiral';
                    document.getElementById('main-subtitle').textContent = 'A colorful spiral from a simple angle rule.';
                    Core.loadCase(RainbowSpiralCase, { mode: 'display' });
                } else if (caseName === 'golden') {
                    document.getElementById('main-title').textContent = 'Fibonacci Golden Spiral';
                    document.getElementById('main-subtitle').textContent = 'A spiral made from Fibonacci numbers.';
                    Core.loadCase(GoldenSpiralCase, { mode: 'display' });
                } else if (caseName === 'hexagon') {
                    document.getElementById('main-title').textContent = 'Hexagonal Grid';
                    document.getElementById('main-subtitle').textContent = 'A pattern made of repeating hexagons.';
                    Core.loadCase(HexagonGridCase, { mode: 'display' });
                } else if (caseName === 'damage') {
                    document.getElementById('main-title').textContent = 'Probability: Damage Rolls';
                    document.getElementById('main-subtitle').textContent = 'See how dice rolls spread over many tries.';
                    Core.loadCase(DamageRollsCase, { mode: 'display' });
                } else if (caseName === 'modulo-circle') {
                    document.getElementById('main-title').textContent = 'Modulo Circle Patterns';
                    document.getElementById('main-subtitle').textContent = 'Animated times-table modulo patterns on a circle.';
                    Core.loadCase(ModuloCircleCase, { mode: 'display' });
                } else if (caseName === 'orbit-spirograph') {
                    document.getElementById('main-title').textContent = 'Orbit Spirograph';
                    document.getElementById('main-subtitle').textContent = 'Center Body vs Orbiting Body trajectory in orbital time.';
                    Core.loadCase(OrbitSpirographCase, { mode: 'display' });
                }
            });
        });

        // Load Default Case
        window.onload = () => {
            if (typeof WavesCase !== 'undefined') {
                Core.loadCase(WavesCase, { mode: 'display' });
            } else {
                console.error("WavesCase failed to load!");
            }
        };

        // Mobile case menu toggle
        (() => {
            const btn = document.getElementById('mobile-tabs-btn');
            const backdrop = document.getElementById('mobile-tabs-backdrop');
            if (!btn || !backdrop) return;

            btn.addEventListener('click', () => {
                document.body.classList.toggle('mobile-tabs-open');
            });
            backdrop.addEventListener('click', () => {
                document.body.classList.remove('mobile-tabs-open');
            });
        })();
    </script>
  </body>
</html>
